# Feature development workflow

---

## Workflow Steps

### [x] Step: Requirements

Your job is to generate a Product Requirements Document based on the feature description,

First, analyze the provided feature definition and determine unclear aspects. For unclear aspects: - Make informed guesses based on context and industry standards - Only mark with [NEEDS CLARIFICATION: specific question] if: - The choice significantly impacts feature scope or user experience - Multiple reasonable interpretations exist with different implications - No reasonable default exists - Prioritize clarifications by impact: scope > security/privacy > user experience > technical details

Ask up to 5 most priority clarifications to the user. Then, create the document following this template:

```
# Feature Specification: [FEATURE NAME]


## User Stories*


### User Story 1 - [Brief Title]

**Acceptance Scenarios**:

1. **Given** [initial state], **When** [action], **Then** [expected outcome]
2. **Given** [initial state], **When** [action], **Then** [expected outcome]

---

## Requirements*

## Success Criteria*

```

Save the PRD into `d:\starbucks_react-main\.zencoder\chats\c02ca5c6-a079-4560-8bb9-852d9b8e791f/requirements.md`.

### [x] Step: Technical Specification

Based on the PRD in `d:\starbucks_react-main\.zencoder\chats\c02ca5c6-a079-4560-8bb9-852d9b8e791f/requirements.md`, create a detailed technical specification to be used by a coding agent to implement the feature. Follow this template:

```
# Technical Specification: [FEATURE]

## Technical Context
Language/Version, primary dependencies, etc

## Technical Implementation Brief

Summarize key technical decisions for implementing the feature. Make sure they take into account the existing code as much as possible.

## Source Code Structure

## Contracts

Define addition or changes in data models, DB schemas, APIs, code interfaces etc

## Delivery Phases

Define several incremental deliverables for the feature. Each should be a minimal viable product testable end-to-end.

## Verification Strategy

Define how the coding agent can verify each deliverable it creates. Provide instructions for the agent to perform the verification using available tools (lint/test commands, bash commands) and create helper scripts and tools for more complex result verification.
The verification for each deliverable should be executable by a coding agent using built-in capabilities (lint and test commands from the project, bash commands), pre-generated helper scripts or MCP servers. Research and add to the spec:

- MCP servers that should be installed to help the agent with the verification

- helper scripts that need to be generated in the first phases of the plan to verify complex scenarios that can't be covered by the tests in the project's test framework(s)

- any sample input artifact(s) that are required for verification. Note if these artifacts can be a) generated by the agent; b) discovered by the agent on line; c) must be provided by the user.
```

Save the spec to `d:\starbucks_react-main\.zencoder\chats\c02ca5c6-a079-4560-8bb9-852d9b8e791f/spec.md`.

### [ ] Step: Implementation Plan

Based on the technical spec in `d:\starbucks_react-main\.zencoder\chats\c02ca5c6-a079-4560-8bb9-852d9b8e791f/spec.md`, create a detailed task plan. Each task should have task definition, references to contracts to be used/implemented, deliverable definition and verification instructions.

---

### [ ] Phase 1: Update Frontend Google OAuth Redirect Logic

**Task Definition**:
Update Login.jsx to capture and use the `redirectPage` parameter from the backend's postMessage event. Currently, the frontend always navigates to `/home` regardless of profile completion status.

**Contracts to Implement**:
- Consume `/auth/google/callback` response which includes `redirectPage` parameter
- Response contract: `{ token, username, redirectPage }`
- redirectPage values: `"home"` or `"profile"`

**Deliverable**:
- Modified `starbucks-frontend/src/Login.jsx` where `handleMessage` respects `redirectPage` parameter
- On receiving postMessage, navigate to `/profile` if `redirectPage === "profile"`, otherwise `/home`

**Verification Instructions**:
1. Manual test: Open the app in a new incognito window
2. Click "Sign In With Google" button
3. Complete Google authentication
4. Verify you are redirected to `/profile` page (first-time user)
5. Check browser console for any errors - should be none
6. Verify token and username are in localStorage

---

### [ ] Phase 2: Enhance Profile.jsx for First-Time Completion

**Task Definition**:
Improve Profile.jsx to handle first-time profile completion with better UX. Add logic to detect first-time users and provide appropriate messaging.

**Contracts to Use**:
- GET `/user/profile` endpoint (contract defined in spec.md)
- PUT `/user/profile` endpoint (contract defined in spec.md)
- User model includes `isFirstLogin` field for detection

**Deliverable**:
- Modified `starbucks-frontend/src/Profile.jsx` that:
  - Detects first-time completion scenario
  - Displays "Complete Your Profile" or similar messaging for first-time users
  - Maintains existing validation (phone: 10 digits, gender: required, DOB: required, address: min 5 chars, age minimum 14)
  - After successful submission, navigates to `/home`

**Verification Instructions**:
1. Go to Profile page (from Phase 1 test)
2. Verify form fields are empty except for pre-filled data (username, email)
3. Fill in all required fields:
   - Phone: 10 digits
   - Gender: select one
   - DOB: select date (must be 14+ years old)
   - Address: min 5 characters
4. Submit form
5. Verify success message appears
6. Verify redirect to `/home` page after 1 second
7. Check MongoDB to verify fields were saved

---

### [ ] Phase 3: Test First-Time vs Returning User Flow

**Task Definition**:
Verify the complete end-to-end flow works correctly for both first-time and returning users with proper redirects.

**Test Scenarios**:

**Scenario 1: First-Time Google Login**
1. Open app in incognito mode
2. Click "Sign In With Google"
3. Complete authentication
4. Verify redirected to `/profile` page
5. Fill and submit profile
6. Verify redirected to `/home` page
7. Verify user data saved in MongoDB

**Scenario 2: Returning User (Profile Already Complete)**
1. Logout from home page (if there's a logout button)
2. Or open same Google account in a different incognito window (if profile was previously completed)
3. Click "Sign In With Google"
4. Verify directly redirected to `/home` page (NOT `/profile`)

**Scenario 3: Profile Updates Persist**
1. From home page, navigate to Profile
2. Click "Edit Profile"
3. Change phone number or another field
4. Submit changes
5. Verify success message
6. Logout and re-login with same Google account
7. Verify redirected to `/home` (not `/profile`)
8. Go to profile and verify changes persisted

**Verification Instructions**:
- Check browser Network tab to verify correct API calls
- Check localStorage for token and username
- Check MongoDB for user document with complete profile
- Verify no JavaScript errors in browser console
- Run project lint/typecheck if available: `npm run lint` or `npm run typecheck`

---

### [ ] Phase 4: Final Testing & Bug Fixes

**Task Definition**:
Run comprehensive tests to ensure the feature works correctly across different scenarios and fix any bugs discovered.

**Verification Instructions**:
1. Run linter on modified files: `cd starbucks-frontend && npm run lint`
2. Check for any type errors if using TypeScript tooling
3. Test on different browsers if possible
4. Test with different Google accounts
5. Verify all existing features still work (cart, checkout, orders)
6. Check for any regressions in other login flows (email/password login)

**Success Criteria**:
- ✅ First-time Google users redirect to Profile page
- ✅ Returning users with complete profile redirect to Home page
- ✅ Profile data saves and persists across sessions
- ✅ Profile updates work correctly
- ✅ No console errors or warnings
- ✅ All existing tests pass
- ✅ Code follows project conventions
